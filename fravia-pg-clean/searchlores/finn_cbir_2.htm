<html>
<head>
<title>finn_cbir_2.htm: Content Based Image Recognition - a stab in PHP, part 2</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="Content-Style-Type" content="text/css">
<META NAME="Author" CONTENT="Finn61">
<META NAME="Keywords" CONTENT="seeking, searching, multimedia, image, recognition, capturing, amassing, sharing, sixty one, 61">
<META NAME="Description" CONTENT="Advanced techniques to scour the unknown net. Content based image searching.">
<meta name="copyright" content="Copyright(c) 2006 Finn61">
<STYLE type="text/css">
A:link { color: #02F }
A:visited  { color: #808 }
A:hover { color: purple; background: #AFB }
</STYLE>
</head>
<body bgcolor="#CCCCCC" text="#001010" link="#0000FF" alink="#00FF00" vlink="#3366CC">
 <center>

<font size="+3">Content Based Image Recognition - a stab in PHP (<font color=blue>2</font>)</font><br><b>By 
<font color="blue">Finn61</font></b><br>
           <br>
<table border="0" align="center"><tr>
<td bgcolor="#993300">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td bgcolor="#993300">&nbsp;&nbsp;</td>
<td bgcolor="#993300"><a target=_top href="essays.htm"><img SRC="images/basipet.jpg" ALT="to essays" 
ALIGN=BOTTOM WIDTH="118" HEIGHT="68" BORDER=0 VSPACE=0 HSPACE=0></a></td>
<td bgcolor="#993300">&nbsp;&nbsp;</td>
</tr>
</table>  <br>

<b>Published @ <a href="http://www.searchlores.org">Searchlores</a> in 
<font color="blue">February 2006</font> | </b>
<b>Version <font color="blue">0.01</font></b><br>
<b>By <font color="blue">Finn61</font></b><br>

   </center>
<hr>


<CENTER><H1>Content Based Image Recognition - a stab in PHP</H1> </CENTER>
<CENTER><H2>(Go to <a href="finn_cbir_1.htm">Part 1</a>) ~ This is part 2 ~</H2></CENTER>
<CENTER><P><B>By Finn61</B></P></CENTER>

<P>OK, finally I have found some time to continue with this essay. To recap,
I've been looking at image analysis and comparison systems to see what benefits
it offers for seekers. In the process I have decided to build my own tools for
testing. Is it possible to perform these tasks in real time? Can we construct 
quick and dirty approximations of cutting edge systems for use on our own
PC's over the web?

<P>Yes. But don't expect miracles.</P>

<P>The idea was to build a tool that can analyse images brought in from the web. A
spider or web crawler could be kicked off and pipe down images from your favorite
art gallery web site for example.

<P>The images would then be compared against the source image for a match. Hopefully
you might then find out things such as information about the source of the image (the 
artist, country, era, etc); or maybe an improved version of the image (quality, resolution, etc).

<P>Obvisouly this isn't a system that gives you instant results. Not if we are talking
about crawling the web for content. Unless of course you already have a massive database
of images in your back pocket then you are going to need to find your targets online.

<P>The design I 
finally decided to go with for image comparison was based on the 
frequency of colours in certain regions of the source and target images.
I have chosen this design as a compromise for speed and experimentation. There are many
variables to tweak, some values giving you good results and others terrible, but
I wanted to build in flexibility so we can experiment and discover what works well
for the sources and targets we have in mind.

<P>Here's the breakdown of things we need to do for the image analysis and comparison:

<P><UL>
	<LI>Normalise the source and target images to standard size (150 x 150)
	<LI>Calculate three 25x25 regions in the image to analyse (total 625 pixels per region)
	<LI>Read in the pixel RGB values
	<LI>Keep count of how many pixels have the same RGB values (or close within a set amount)
	<LI>Sort the list of RGB values to build a top 10 list of the most frequent colours
	<LI>Compare top 10 lists of source and target for each region
	<LI>Determine how many regions match (based on top 10 list comparison)
	<LI>Write out log with results (including thumbnails, URL's etc)
</UL>

<P><B>But Where Do The Targets Come From?</B>

<P>In my first example you input both the source and target images. This works
for the purpose of experimenting and tuning. It has a nice verbose output with thumbnails
so you can get an idea of what is going on. Later, to speed things up, I will ditch the
pleasantries and only write out text.

<P>When you really want to use 
this tool to search for images you will need to spider the web.

<P>Unfortunately I cannot provide everyone with a web spider using my resources. But 
I can provide the source so you can run it yourself, using your own bandwidth.

<P>Before I jump in to discuss the code here is the form to submit image comparisons. For
those who aren't intrested in the php you can play around with this straight away. For 
those who want to see what's driving it then read on.

<HR>

<P><B>Web Form - Image Compare Example 1</B>

<FORM METHOD=GET ACTION="http://finn61.sytes.net/test/resizer.php">

Source Image
<SELECT NAME="srcimg">
<OPTION>fractal01.jpg</OPTION>
<OPTION>fractal02.jpg</OPTION>
<OPTION>fractal03.jpg</OPTION>
<OPTION>fractal04.jpg</OPTION>
<OPTION>fractal05.jpg</OPTION>
<OPTION>fractal06.jpg</OPTION>
</SELECT>
&nbsp;&nbsp;&nbsp;
Target Image
<SELECT NAME="tarimg">
<OPTION>fractal01.jpg</OPTION>
<OPTION>fractal02.jpg</OPTION>
<OPTION>fractal03.jpg</OPTION>
<OPTION>fractal04.jpg</OPTION>
<OPTION>fractal05.jpg</OPTION>
<OPTION>fractal06.jpg</OPTION>
</SELECT>

<P>Colour proximity:
<INPUT TYPE="text" NAME="prox" size=2 value="10">
<I>&nbsp;&nbsp;How much variation in the RGB value for each pixel to still be a match (0-254).</I>

<P>Region variation:
<INPUT TYPE="text" NAME="rvar" size=2 value="10">
<I>&nbsp;&nbsp;How many of the top 10 colours need to be the same (0-10).</I>

<P>Prevalence Order:
<INPUT TYPE="radio" NAME="prev" VALUE="y">Yes
<INPUT TYPE="radio" NAME="prev" VALUE="n" CHECKED>No
<I>&nbsp;&nbsp;Does the order of the top 10 matter?</I>
<BR><I>If yes then this compares the number 1 most frequent colour in the source image to the number 1 most frequent colour in the target and
then the number 2 most frequent colour in the source with the number 2 in the target and so on.</I>
<BR><I>If no then it will compare the number 1 most frequent colour in the source image with all the top 10 colours in the target. In other words
the order doesn't matter, just as long as it matches another top 10 colour, not necessarily with the same ranking.</I>


<P><INPUT TYPE="submit">

</FORM>

<HR>
<P><B>Image Compare Example 2</B>
<P>In this example you can see how these two images get recognised as a match.  Click on each of them to see the differences in the 
originals.  One has been resized and one has been run through a filter slightly blurring it.  Because the images are normalised to the
same size before comparing and the colours have been kept roughly the same we get a positive result.
<P><a target=_top HREF="http://finn61.sytes.net/test/resizer.php?srcimg=gi-mod_01.jpg&tarimg=gi-mod_07.jpg&prox=15&rvar=2&prev=y"> http://finn61.sytes.net/test/resizer.php?srcimg=gi-mod_01.jpg&tarimg=gi-mod_07.jpg&prox=15&rvar=2&prev=y</A>

<HR>
<P><B>Image Compare Example 3</B>
<P>This example displays how this system based on colour matching, breaks down. These two paintings were both painted by Overbeck
but at different times.  The copy is significantly lighter and hence using the same parameters as above it fails to detect a match.


<P><A HREF="http://finn61.sytes.net/test/resizer.php?srcimg=http%3A%2F%2Fwww.wga.hu%2Fart%2Fo%2Foverbeck%2Fitalia1.jpg&tarimg=http%3A%2F%2Fwww.wga.hu%2Fart%2Fo%2Foverbeck%2Fitalia2.jpg&prox=10&rvar=2&prev=n">
http://finn61.sytes.net/test/resizer.php?srcimg=http%3A%2F%2Fwww.wga.hu%2Fart%2Fo%2Foverbeck%2Fitalia1.jpg&tarimg=http%3A%2F%2Fwww.wga.hu%2Fart%2Fo%2Foverbeck%2Fitalia2.jpg&prox=10&rvar=2&prev=n</A>

<P>You will probably have noticed by now that you can run your own comparisons by specifying the parms, including the source and target images,
in the URL.

<HR>

<P><B>Image Compare Code</B>
<P><I>Note: All this codes is licensed under GPL which means please take and use it for your own work but you have to share the
fruits of your labour.</I></P>
<P>Rather than bore you with blow by blow descriptions of each line of code I have tried to include meaningful comments within the
php itself.  Let me know if it's difficult to follow.
<P>The image analysis is mainly in one chunk of php with a few smaller scripts
called from within html image tags such as drawing boxes on images and blocks of 
colour.
<P><UL>
	<LI>resizer.php - Main php block, calls the other scripts
	<LI>drawbox.php - When passed a source img (URL) returns a resized jpg with the region boxes drawn on it
	<LI>rgthumb.php - When passed a source img with x and y start position will return a jpg of a 25 x 25 section
	<LI>block.php - When passed rgb values returns a 15 x 15 jpg of solid colour.
</UL>

<P>Here's the code to display a colour block. You call it, passing rgb values and it returns a 15x15 jpg image. 
It's only used for display purposes.
<BR> You would use a html img tag such as this to call it:
<P>&lt;IMG SRC="block.php?red=120&grn=120&blu=120" BORDER=0&gt;

<P>
<code><font color="#000000">
<font color="#0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp;&nbsp;header</font><font color="#007700">(</font><font color="#DD0000">"Content-type: image/jpeg"</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$red </font><font color="#007700">= </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'red'</font><font color="#007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$grn </font><font color="#007700">= </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'grn'</font><font color="#007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$blu </font><font color="#007700">= </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'blu'</font><font color="#007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$im&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">= </font><font color="#0000BB">imagecreate</font><font color="#007700">(</font><font color="#0000BB">15</font><font color="#007700">, </font><font color="#0000BB">15</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$colour </font><font color="#007700">= </font><font color="#0000BB">imagecolorallocate</font><font color="#007700">(</font><font color="#0000BB">$im</font><font color="#007700">, </font><font color="#0000BB">$red</font><font color="#007700">, </font><font color="#0000BB">$grn</font><font color="#007700">, </font><font color="#0000BB">$blu</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagejpeg</font><font color="#007700">(</font><font color="#0000BB">$im</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagedestroy</font><font color="#007700">(</font><font color="#0000BB">$im</font><font color="#007700">);<br /></font><font color="#0000BB">?&gt;<br /></font>
</font>
</code>

<P>Here's the rgthumb.php code which displays a 25x25 section of an image (after resampling down to 150x150). 3 paramaters are passed, the source
image and the x, y coordinates of the section you want returned from the image. Again, it's only used for display purposes.
<BR> You would use a html img tag such as this to call it:
<P>&lt;IMG SRC="rgthumb.php?srcimg=overbeck.jpg&posx=100&posy=35" BORDER=0&gt;

<P>
<code><font color="#000000">
<font color="#0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp;&nbsp;$srcimg </font><font color="#007700">= </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'srcimg'</font><font color="#007700">]; </font><font color="#FF8000">//url of source image<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$posx </font><font color="#007700">= </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'posx'</font><font color="#007700">]; </font><font color="#FF8000">//x coordinate<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$posy </font><font color="#007700">= </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'posy'</font><font color="#007700">]; </font><font color="#FF8000">//y coordinate<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">list(</font><font color="#0000BB">$srcwidth</font><font color="#007700">, </font><font color="#0000BB">$srcheight</font><font color="#007700">) = </font><font color="#0000BB">getimagesize</font><font color="#007700">(</font><font color="#0000BB">$srcimg</font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$newsrcimg </font><font color="#007700">= </font><font color="#0000BB">ImageCreateFromJpeg</font><font color="#007700">(</font><font color="#0000BB">$srcimg</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$newresimg </font><font color="#007700">= </font><font color="#0000BB">ImageCreateTruecolor</font><font color="#007700">(</font><font color="#0000BB">150</font><font color="#007700">, </font><font color="#0000BB">150</font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Resample image to a standard 150 x 150 size<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagecopyresampled</font><font color="#007700">(</font><font color="#0000BB">$newresimg</font><font color="#007700">, </font><font color="#0000BB">$newsrcimg</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">150</font><font color="#007700">, </font><font color="#0000BB">150</font><font color="#007700">, </font><font color="#0000BB">$srcwidth</font><font color="#007700">, </font><font color="#0000BB">$srcheight</font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$rgthumb </font><font color="#007700">= </font><font color="#0000BB">ImageCreateTruecolor</font><font color="#007700">(</font><font color="#0000BB">25</font><font color="#007700">, </font><font color="#0000BB">25</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagecopy</font><font color="#007700">(</font><font color="#0000BB">$rgthumb</font><font color="#007700">, </font><font color="#0000BB">$newresimg</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">$posx</font><font color="#007700">, </font><font color="#0000BB">$posy</font><font color="#007700">, </font><font color="#0000BB">150</font><font color="#007700">, </font><font color="#0000BB">150</font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">header</font><font color="#007700">(</font><font color="#DD0000">'Content-type: image/jpeg'</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Create jpeg header<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagejpeg</font><font color="#007700">(</font><font color="#0000BB">$rgthumb</font><font color="#007700">, </font><font color="#0000BB">null</font><font color="#007700">, </font><font color="#0000BB">100</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Send image to browser<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagedestroy</font><font color="#007700">(</font><font color="#0000BB">$newresimg</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Destroy image to release memory<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagedestroy</font><font color="#007700">(</font><font color="#0000BB">$newsrcimg</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Destroy image to release memory<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagedestroy</font><font color="#007700">(</font><font color="#0000BB">$rgthumb</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Destroy image to release memory<br /></font><font color="#0000BB">?&gt;</font>
</font>
</code>

<P>Here's the drawbox.php code which is pretty chunky and only for demonstrative purposes so you can get a nice display. Only
one parm is passed and that is the source image. It returns the image resampled to 150x150 with three boxes showing you the regions to be
analysed.
<BR> You would use a html img tag such as this to call it:
<P>&lt;IMG SRC="drawbox.php?srcimg=overbeck.jpg" BORDER=0&gt;

<P>
<code><font color="#000000">
<font color="#0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp;&nbsp;$srcimg </font><font color="#007700">= </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'img'</font><font color="#007700">]; </font><font color="#FF8000">//url of source image<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">list(</font><font color="#0000BB">$srcwidth</font><font color="#007700">, </font><font color="#0000BB">$srcheight</font><font color="#007700">) = </font><font color="#0000BB">getimagesize</font><font color="#007700">(</font><font color="#0000BB">$srcimg</font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$new_width </font><font color="#007700">= </font><font color="#0000BB">150</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$new_height </font><font color="#007700">= </font><font color="#0000BB">150</font><font color="#007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$newsrcimg </font><font color="#007700">= </font><font color="#0000BB">ImageCreateFromJpeg</font><font color="#007700">(</font><font color="#0000BB">$srcimg</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$newresimg </font><font color="#007700">= </font><font color="#0000BB">ImageCreateTruecolor</font><font color="#007700">(</font><font color="#0000BB">$new_width</font><font color="#007700">, </font><font color="#0000BB">$new_height</font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Resample image to a standard 150 x 150 size<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagecopyresampled</font><font color="#007700">(</font><font color="#0000BB">$newresimg</font><font color="#007700">, </font><font color="#0000BB">$newsrcimg</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">$new_width</font><font color="#007700">, </font><font color="#0000BB">$new_height</font><font color="#007700">, </font><font color="#0000BB">$srcwidth</font><font color="#007700">, </font><font color="#0000BB">$srcheight</font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Create a garish colour to draw on image so it is contrasting (hopefully)<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$fluro </font><font color="#007700">= </font><font color="#0000BB">imagecolorclosest</font><font color="#007700">(</font><font color="#0000BB">$newresimg</font><font color="#007700">, </font><font color="#0000BB">155</font><font color="#007700">, </font><font color="#0000BB">255</font><font color="#007700">, </font><font color="#0000BB">155</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">drawbox</font><font color="#007700">(</font><font color="#0000BB">10</font><font color="#007700">,</font><font color="#0000BB">10</font><font color="#007700">,</font><font color="#0000BB">35</font><font color="#007700">,</font><font color="#0000BB">35</font><font color="#007700">,</font><font color="#0000BB">$newresimg</font><font color="#007700">,</font><font color="#0000BB">$fluro</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to draw box around region<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">drawbox</font><font color="#007700">(</font><font color="#0000BB">115</font><font color="#007700">,</font><font color="#0000BB">115</font><font color="#007700">,</font><font color="#0000BB">140</font><font color="#007700">,</font><font color="#0000BB">140</font><font color="#007700">,</font><font color="#0000BB">$newresimg</font><font color="#007700">,</font><font color="#0000BB">$fluro</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to draw box around region<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">drawbox</font><font color="#007700">(</font><font color="#0000BB">62</font><font color="#007700">,</font><font color="#0000BB">62</font><font color="#007700">,</font><font color="#0000BB">87</font><font color="#007700">,</font><font color="#0000BB">87</font><font color="#007700">,</font><font color="#0000BB">$newresimg</font><font color="#007700">,</font><font color="#0000BB">$fluro</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to draw box around region<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">header</font><font color="#007700">(</font><font color="#DD0000">'Content-type: image/jpeg'</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Create jpeg header<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagejpeg</font><font color="#007700">(</font><font color="#0000BB">$newresimg</font><font color="#007700">, </font><font color="#0000BB">null</font><font color="#007700">, </font><font color="#0000BB">100</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Send image to browser<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagedestroy</font><font color="#007700">(</font><font color="#0000BB">$newresimg</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Destroy image to get memory back<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagedestroy</font><font color="#007700">(</font><font color="#0000BB">$newsrcimg</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Destroy image to get memory back<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">drawbox</font><font color="#007700">(</font><font color="#0000BB">$begx</font><font color="#007700">,</font><font color="#0000BB">$begy</font><font color="#007700">,</font><font color="#0000BB">$endx</font><font color="#007700">,</font><font color="#0000BB">$endy</font><font color="#007700">,</font><font color="#0000BB">$newresimg</font><font color="#007700">,</font><font color="#0000BB">$fluro</font><font color="#007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Draw a 1 pixel wide box around the region.<br />&nbsp;&nbsp;&nbsp;&nbsp;//Parms: $begx = starting row<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$begy = starting col<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$endx = end row<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$endy = end col<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newresimg = image to draw box on<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fluro = colour to draw box<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (</font><font color="#0000BB">$x </font><font color="#007700">= </font><font color="#0000BB">$begx</font><font color="#007700">; </font><font color="#0000BB">$x </font><font color="#007700">!= </font><font color="#0000BB">$endx </font><font color="#007700">+ </font><font color="#0000BB">1</font><font color="#007700">; </font><font color="#0000BB">$x</font><font color="#007700">++) {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagesetpixel</font><font color="#007700">(</font><font color="#0000BB">$newresimg</font><font color="#007700">, </font><font color="#0000BB">$x</font><font color="#007700">, </font><font color="#0000BB">$begy</font><font color="#007700">, </font><font color="#0000BB">$fluro</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For (</font><font color="#0000BB">$y </font><font color="#007700">= </font><font color="#0000BB">$begy</font><font color="#007700">; </font><font color="#0000BB">$y </font><font color="#007700">!= </font><font color="#0000BB">$endy </font><font color="#007700">+ </font><font color="#0000BB">1</font><font color="#007700">; </font><font color="#0000BB">$y</font><font color="#007700">++) {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagesetpixel</font><font color="#007700">(</font><font color="#0000BB">$newresimg</font><font color="#007700">, </font><font color="#0000BB">$begx</font><font color="#007700">, </font><font color="#0000BB">$y</font><font color="#007700">, </font><font color="#0000BB">$fluro</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagesetpixel</font><font color="#007700">(</font><font color="#0000BB">$newresimg</font><font color="#007700">, </font><font color="#0000BB">$endx</font><font color="#007700">, </font><font color="#0000BB">$y</font><font color="#007700">, </font><font color="#0000BB">$fluro</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (</font><font color="#0000BB">$x </font><font color="#007700">= </font><font color="#0000BB">$begx</font><font color="#007700">; </font><font color="#0000BB">$x </font><font color="#007700">!= </font><font color="#0000BB">$endx </font><font color="#007700">+ </font><font color="#0000BB">1</font><font color="#007700">; </font><font color="#0000BB">$x</font><font color="#007700">++) {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagesetpixel</font><font color="#007700">(</font><font color="#0000BB">$newresimg</font><font color="#007700">, </font><font color="#0000BB">$x</font><font color="#007700">, </font><font color="#0000BB">$endy</font><font color="#007700">, </font><font color="#0000BB">$fluro</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /></font><font color="#0000BB">?&gt;</font>
</font>
</code>

<P>Here's the main body of code used in the form above. You will see calls to the three scripts above. It's still a work in progress so this is
very likely to change as I implement new features or optimisations. I'll try and improve the comments at some stage too.

<P>
<code><font color="#000000">
&lt;HTML&gt;<br />&lt;HEAD&gt;<br />&lt;TITLE&gt; Image Compare &lt;/TITLE&gt;<br />&lt;META NAME="Author" CONTENT="Finn61"&gt;<br />&lt;META NAME="Keywords" CONTENT=""&gt;<br />&lt;META NAME="Description" CONTENT=""&gt;<br />&lt;/HEAD&gt;<br /><br />&lt;BODY bgcolor="#D5FFF1" TEXT=#001010 LINK="#0000FF" ALINK="#00FF00" VLINK="#3366CC"&gt;<br /><br /><font color="#0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Get the parameters passed at run time<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$srcurl </font><font color="#007700">= </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'srcimg'</font><font color="#007700">]; </font><font color="#FF8000">//url of source image<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$tarurl </font><font color="#007700">= </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'tarimg'</font><font color="#007700">]; </font><font color="#FF8000">//url of target image<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$prox </font><font color="#007700">= </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'prox'</font><font color="#007700">]; </font><font color="#FF8000">//prox variation<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$rvar </font><font color="#007700">= </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'rvar'</font><font color="#007700">]; </font><font color="#FF8000">//region variation<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$prev </font><font color="#007700">= </font><font color="#0000BB">$_GET</font><font color="#007700">[</font><font color="#DD0000">'prev'</font><font color="#007700">]; </font><font color="#FF8000">//prevalence order checking<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;//Determine size of original images<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">list(</font><font color="#0000BB">$srcwidth</font><font color="#007700">, </font><font color="#0000BB">$srcheight</font><font color="#007700">) = </font><font color="#0000BB">getimagesize</font><font color="#007700">(</font><font color="#0000BB">$srcurl</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;list(</font><font color="#0000BB">$tarwidth</font><font color="#007700">, </font><font color="#0000BB">$tarheight</font><font color="#007700">) = </font><font color="#0000BB">getimagesize</font><font color="#007700">(</font><font color="#0000BB">$tarurl</font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Create an image from the source url<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$srcimg </font><font color="#007700">= </font><font color="#0000BB">ImageCreateFromJpeg</font><font color="#007700">(</font><font color="#0000BB">$srcurl</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$newsrcimg </font><font color="#007700">= </font><font color="#0000BB">ImageCreateTruecolor</font><font color="#007700">(</font><font color="#0000BB">150</font><font color="#007700">, </font><font color="#0000BB">150</font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Create an image from the target url<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$tarimg </font><font color="#007700">= </font><font color="#0000BB">ImageCreateFromJpeg</font><font color="#007700">(</font><font color="#0000BB">$tarurl</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$newtarimg </font><font color="#007700">= </font><font color="#0000BB">ImageCreateTruecolor</font><font color="#007700">(</font><font color="#0000BB">150</font><font color="#007700">, </font><font color="#0000BB">150</font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Resample images to a standard 150 x 150 size<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagecopyresampled</font><font color="#007700">(</font><font color="#0000BB">$newsrcimg</font><font color="#007700">, </font><font color="#0000BB">$srcimg</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">150</font><font color="#007700">, </font><font color="#0000BB">150</font><font color="#007700">, </font><font color="#0000BB">$srcwidth</font><font color="#007700">, </font><font color="#0000BB">$srcheight</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagecopyresampled</font><font color="#007700">(</font><font color="#0000BB">$newtarimg</font><font color="#007700">, </font><font color="#0000BB">$tarimg</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">0</font><font color="#007700">, </font><font color="#0000BB">150</font><font color="#007700">, </font><font color="#0000BB">150</font><font color="#007700">, </font><font color="#0000BB">$tarwidth</font><font color="#007700">, </font><font color="#0000BB">$tarheight</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagedestroy</font><font color="#007700">(</font><font color="#0000BB">$srcimg</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Destroy old source image to get memory back<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagedestroy</font><font color="#007700">(</font><font color="#0000BB">$tarimg</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Destroy old target image to get memory back<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;//Draw source and target image resized to 150x150 with sample regions indicated<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">"&lt;center&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"&lt;P&gt;Click images to see original before resampling.&lt;/P&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"&lt;A HREF=\"$srcurl\"&gt;&lt;IMG SRC=\"drawbox.php?img=$srcurl\" BORDER=0 ALT=\"\"&gt;&lt;/A&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"&amp;nbsp;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"&lt;A HREF=\"$tarurl\"&gt;&lt;IMG SRC=\"drawbox.php?img=$tarurl\" BORDER=0 ALT=\"\"&gt;&lt;/A&gt;"</font><font color="#007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//<br />&nbsp;&nbsp;&nbsp;&nbsp;//REGION 1 PROCESSING<br />&nbsp;&nbsp;&nbsp;&nbsp;//<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">thumbs</font><font color="#007700">(</font><font color="#0000BB">$srcurl</font><font color="#007700">,</font><font color="#0000BB">$tarurl</font><font color="#007700">,</font><font color="#0000BB">10</font><font color="#007700">,</font><font color="#0000BB">10</font><font color="#007700">,</font><font color="#0000BB">1</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to draw thumbs for region 1<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$region </font><font color="#007700">= </font><font color="#0000BB">pixelread</font><font color="#007700">(</font><font color="#0000BB">$newsrcimg</font><font color="#007700">,</font><font color="#0000BB">10</font><font color="#007700">,</font><font color="#0000BB">10</font><font color="#007700">,</font><font color="#0000BB">$prox</font><font color="#007700">);</font><font color="#FF8000">//Call function to analyse region1<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">"Number of unique colours in region 1 of source: "</font><font color="#007700">.</font><font color="#0000BB">count</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">]).</font><font color="#DD0000">"&lt;BR&gt;"</font><font color="#007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sregion </font><font color="#007700">= </font><font color="#0000BB">topten</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to sort top 10 colours<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$region </font><font color="#007700">= </font><font color="#0000BB">pixelread</font><font color="#007700">(</font><font color="#0000BB">$newtarimg</font><font color="#007700">,</font><font color="#0000BB">10</font><font color="#007700">,</font><font color="#0000BB">10</font><font color="#007700">,</font><font color="#0000BB">$prox</font><font color="#007700">);</font><font color="#FF8000">//Call function to analyse region1<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">"Number of unique colours in region 1 of target: "</font><font color="#007700">.</font><font color="#0000BB">count</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">]).</font><font color="#DD0000">"&lt;BR&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$tregion </font><font color="#007700">= </font><font color="#0000BB">topten</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to sort top 10 colours<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">printblocks</font><font color="#007700">(</font><font color="#0000BB">$sregion</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to print top 10 colours<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">"&amp;nbsp;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">printblocks</font><font color="#007700">(</font><font color="#0000BB">$tregion</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to print top 10 colours<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">comp</font><font color="#007700">(</font><font color="#0000BB">$sregion</font><font color="#007700">,</font><font color="#0000BB">$tregion</font><font color="#007700">,</font><font color="#0000BB">$prox</font><font color="#007700">,</font><font color="#0000BB">$rvar</font><font color="#007700">,</font><font color="#0000BB">$prev</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to compare top 10 lists<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;//<br />&nbsp;&nbsp;&nbsp;&nbsp;//REGION 2 PROCESSING<br />&nbsp;&nbsp;&nbsp;&nbsp;//<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">thumbs</font><font color="#007700">(</font><font color="#0000BB">$srcurl</font><font color="#007700">,</font><font color="#0000BB">$tarurl</font><font color="#007700">,</font><font color="#0000BB">62</font><font color="#007700">,</font><font color="#0000BB">62</font><font color="#007700">,</font><font color="#0000BB">2</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to draw thumbs for region 2<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$region </font><font color="#007700">= </font><font color="#0000BB">pixelread</font><font color="#007700">(</font><font color="#0000BB">$newsrcimg</font><font color="#007700">,</font><font color="#0000BB">62</font><font color="#007700">,</font><font color="#0000BB">62</font><font color="#007700">,</font><font color="#0000BB">$prox</font><font color="#007700">);</font><font color="#FF8000">//Call function to analyse region2<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">"Number of unique colours in region2 of source: "</font><font color="#007700">.</font><font color="#0000BB">count</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">]).</font><font color="#DD0000">"&lt;BR&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sregion </font><font color="#007700">= </font><font color="#0000BB">topten</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to sort top 10 colours<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$region </font><font color="#007700">= </font><font color="#0000BB">pixelread</font><font color="#007700">(</font><font color="#0000BB">$newtarimg</font><font color="#007700">,</font><font color="#0000BB">62</font><font color="#007700">,</font><font color="#0000BB">62</font><font color="#007700">,</font><font color="#0000BB">$prox</font><font color="#007700">);</font><font color="#FF8000">//Call function to analyse region2<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">"Number of unique colours in region2 of target: "</font><font color="#007700">.</font><font color="#0000BB">count</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">]).</font><font color="#DD0000">"&lt;BR&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$tregion </font><font color="#007700">= </font><font color="#0000BB">topten</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to sort top 10 colours<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">printblocks</font><font color="#007700">(</font><font color="#0000BB">$sregion</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to print top 10 colours<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">"&amp;nbsp;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">printblocks</font><font color="#007700">(</font><font color="#0000BB">$tregion</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to print top 10 colours<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">comp</font><font color="#007700">(</font><font color="#0000BB">$sregion</font><font color="#007700">,</font><font color="#0000BB">$tregion</font><font color="#007700">,</font><font color="#0000BB">$prox</font><font color="#007700">,</font><font color="#0000BB">$rvar</font><font color="#007700">,</font><font color="#0000BB">$prev</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to compare top 10 lists<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;//<br />&nbsp;&nbsp;&nbsp;&nbsp;//REGION 3 PROCESSING<br />&nbsp;&nbsp;&nbsp;&nbsp;//<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">thumbs</font><font color="#007700">(</font><font color="#0000BB">$srcurl</font><font color="#007700">,</font><font color="#0000BB">$tarurl</font><font color="#007700">,</font><font color="#0000BB">115</font><font color="#007700">,</font><font color="#0000BB">115</font><font color="#007700">,</font><font color="#0000BB">3</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to draw thumbs for region 3<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$region </font><font color="#007700">= </font><font color="#0000BB">pixelread</font><font color="#007700">(</font><font color="#0000BB">$newsrcimg</font><font color="#007700">,</font><font color="#0000BB">115</font><font color="#007700">,</font><font color="#0000BB">115</font><font color="#007700">,</font><font color="#0000BB">$prox</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to analyse region3<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">"Number of unique colours in region3 of source: "</font><font color="#007700">.</font><font color="#0000BB">count</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">]).</font><font color="#DD0000">"&lt;BR&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sregion </font><font color="#007700">= </font><font color="#0000BB">topten</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to sort top 10 colours<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$region </font><font color="#007700">= </font><font color="#0000BB">pixelread</font><font color="#007700">(</font><font color="#0000BB">$newtarimg</font><font color="#007700">,</font><font color="#0000BB">115</font><font color="#007700">,</font><font color="#0000BB">115</font><font color="#007700">,</font><font color="#0000BB">$prox</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to analyse region3<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">"Number of unique colours in region3 of target: "</font><font color="#007700">.</font><font color="#0000BB">count</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">]).</font><font color="#DD0000">"&lt;BR&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$tregion </font><font color="#007700">= </font><font color="#0000BB">topten</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to sort top 10 colours<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">printblocks</font><font color="#007700">(</font><font color="#0000BB">$sregion</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to print top 10 colours<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">"&amp;nbsp;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">printblocks</font><font color="#007700">(</font><font color="#0000BB">$tregion</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to print top 10 colours<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">comp</font><font color="#007700">(</font><font color="#0000BB">$sregion</font><font color="#007700">,</font><font color="#0000BB">$tregion</font><font color="#007700">,</font><font color="#0000BB">$prox</font><font color="#007700">,</font><font color="#0000BB">$rvar</font><font color="#007700">,</font><font color="#0000BB">$prev</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to compare top 10 lists<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;//CLEANUP<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagedestroy</font><font color="#007700">(</font><font color="#0000BB">$newsrcimg</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Destroy image to get memory back<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">imagedestroy</font><font color="#007700">(</font><font color="#0000BB">$newtarimg</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Destroy image to get memory back<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;// END OF MAINLINE<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000BB">pixelread</font><font color="#007700">(</font><font color="#0000BB">$newresimg</font><font color="#007700">,</font><font color="#0000BB">$row</font><font color="#007700">,</font><font color="#0000BB">$col</font><font color="#007700">,</font><font color="#0000BB">$prox</font><font color="#007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Create loop to move through each location in the region<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reading in the RGB values for that location. <br />&nbsp;&nbsp;&nbsp;&nbsp;//Parms: $row = Starting row<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$col = Starting column<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newresimg = image to analyse<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$region </font><font color="#007700">= array();&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//create array so it's not empty on first pass<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$cnt </font><font color="#007700">= </font><font color="#0000BB">0</font><font color="#007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (</font><font color="#0000BB">$y </font><font color="#007700">= </font><font color="#0000BB">$row</font><font color="#007700">; </font><font color="#0000BB">$y </font><font color="#007700">!= </font><font color="#0000BB">$row </font><font color="#007700">+ </font><font color="#0000BB">25</font><font color="#007700">; </font><font color="#0000BB">$y</font><font color="#007700">++) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (</font><font color="#0000BB">$x </font><font color="#007700">= </font><font color="#0000BB">$col</font><font color="#007700">; </font><font color="#0000BB">$x </font><font color="#007700">!= </font><font color="#0000BB">$col </font><font color="#007700">+ </font><font color="#0000BB">25</font><font color="#007700">; </font><font color="#0000BB">$x</font><font color="#007700">++) {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Read in the RGB value from pixel at x,y location<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$ind </font><font color="#007700">= </font><font color="#0000BB">imagecolorat</font><font color="#007700">(</font><font color="#0000BB">$newresimg</font><font color="#007700">, </font><font color="#0000BB">$x</font><font color="#007700">, </font><font color="#0000BB">$y</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$colrs </font><font color="#007700">= </font><font color="#0000BB">imagecolorsforindex</font><font color="#007700">(</font><font color="#0000BB">$newresimg</font><font color="#007700">, </font><font color="#0000BB">$ind</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$red </font><font color="#007700">= </font><font color="#0000BB">$colrs</font><font color="#007700">[</font><font color="#DD0000">'red'</font><font color="#007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$grn </font><font color="#007700">= </font><font color="#0000BB">$colrs</font><font color="#007700">[</font><font color="#DD0000">'green'</font><font color="#007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$blu </font><font color="#007700">= </font><font color="#0000BB">$colrs</font><font color="#007700">[</font><font color="#DD0000">'blue'</font><font color="#007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$region </font><font color="#007700">= </font><font color="#0000BB">palcount</font><font color="#007700">(</font><font color="#0000BB">$red</font><font color="#007700">,</font><font color="#0000BB">$grn</font><font color="#007700">,</font><font color="#0000BB">$blu</font><font color="#007700">,</font><font color="#0000BB">$region</font><font color="#007700">,</font><font color="#0000BB">$prox</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Call function to add this colour to our list <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$cnt</font><font color="#007700">++;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(</font><font color="#0000BB">$region</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function </font><font color="#0000BB">palcount</font><font color="#007700">(</font><font color="#0000BB">$red</font><font color="#007700">,</font><font color="#0000BB">$grn</font><font color="#007700">,</font><font color="#0000BB">$blu</font><font color="#007700">,</font><font color="#0000BB">$region1</font><font color="#007700">,</font><font color="#0000BB">$prox</font><font color="#007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Create an array of all unique colours, keeping count of previous hits.<br />&nbsp;&nbsp;&nbsp;&nbsp;//Parms: $red = value for red<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $grn = value for green<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $blu = value for blue<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $region1 = array containing previous rgb values<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $prox = amount of variation allowed either side of a value<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Check if the colour matches one we already have recorded in the array<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Allow a variation of $prox. The if's are nested just for neatness.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$found </font><font color="#007700">= </font><font color="#0000BB">false</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (</font><font color="#0000BB">$i </font><font color="#007700">= </font><font color="#0000BB">1</font><font color="#007700">; (isset(</font><font color="#0000BB">$region1</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">])) &amp;&amp; (</font><font color="#0000BB">$found </font><font color="#007700">== </font><font color="#0000BB">false</font><font color="#007700">); </font><font color="#0000BB">$i</font><font color="#007700">++) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((</font><font color="#0000BB">$region1</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &lt; </font><font color="#0000BB">$red </font><font color="#007700">+ </font><font color="#0000BB">$prox</font><font color="#007700">) &amp;&amp; (</font><font color="#0000BB">$region1</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &gt; </font><font color="#0000BB">$red </font><font color="#007700">- </font><font color="#0000BB">$prox</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((</font><font color="#0000BB">$region1</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &lt; </font><font color="#0000BB">$grn </font><font color="#007700">+ </font><font color="#0000BB">$prox</font><font color="#007700">) &amp;&amp; (</font><font color="#0000BB">$region1</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &gt; </font><font color="#0000BB">$grn </font><font color="#007700">- </font><font color="#0000BB">$prox</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((</font><font color="#0000BB">$region1</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &lt; </font><font color="#0000BB">$blu </font><font color="#007700">+ </font><font color="#0000BB">$prox</font><font color="#007700">) &amp;&amp; (</font><font color="#0000BB">$region1</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &gt; </font><font color="#0000BB">$blu </font><font color="#007700">- </font><font color="#0000BB">$prox</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$region1</font><font color="#007700">[</font><font color="#0000BB">3</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">]++;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Increment the counter for this colour<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$found </font><font color="#007700">= </font><font color="#0000BB">true</font><font color="#007700">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Set a flag so we know it's matched<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//If the colour doesn't already match then record it in a new element<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if (</font><font color="#0000BB">$found </font><font color="#007700">== </font><font color="#0000BB">false</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$region1</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][] = </font><font color="#0000BB">$red</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$region1</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][] = </font><font color="#0000BB">$grn</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$region1</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][] = </font><font color="#0000BB">$blu</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$region1</font><font color="#007700">[</font><font color="#0000BB">3</font><font color="#007700">][] = </font><font color="#0000BB">1</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(</font><font color="#0000BB">$region1</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//pass the array back<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function </font><font color="#0000BB">topten</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Check we have at least 10 elements in the array, otherwise we can't compare.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if (</font><font color="#0000BB">count</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">]) &lt; </font><font color="#0000BB">10</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"&lt;BR&gt;&lt;B&gt;ERROR:&lt;/B&gt; Colour proximity is too high to get 10 unique colours. Try again."</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Sort in reverse highest to lowest<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">arsort</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">[</font><font color="#0000BB">3</font><font color="#007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//List out the top 10 and save each one into a new array<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$cnt </font><font color="#007700">= </font><font color="#0000BB">1</font><font color="#007700">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Preset counter to keep track how many loops we make<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">while ((list(</font><font color="#0000BB">$key</font><font color="#007700">) = </font><font color="#0000BB">each</font><font color="#007700">(</font><font color="#0000BB">$region</font><font color="#007700">[</font><font color="#0000BB">3</font><font color="#007700">])) &amp;&amp; (</font><font color="#0000BB">$cnt </font><font color="#007700">&lt; </font><font color="#0000BB">11</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sorted</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$cnt</font><font color="#007700">] = </font><font color="#0000BB">$region</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$key</font><font color="#007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sorted</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$cnt</font><font color="#007700">] = </font><font color="#0000BB">$region</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$key</font><font color="#007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sorted</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][</font><font color="#0000BB">$cnt</font><font color="#007700">] = </font><font color="#0000BB">$region</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][</font><font color="#0000BB">$key</font><font color="#007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$sorted</font><font color="#007700">[</font><font color="#0000BB">3</font><font color="#007700">][</font><font color="#0000BB">$cnt</font><font color="#007700">] = </font><font color="#0000BB">$region</font><font color="#007700">[</font><font color="#0000BB">3</font><font color="#007700">][</font><font color="#0000BB">$key</font><font color="#007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$cnt</font><font color="#007700">++;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(</font><font color="#0000BB">$sorted</font><font color="#007700">);&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//pass the array back<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function </font><font color="#0000BB">printblocks</font><font color="#007700">(</font><font color="#0000BB">$sorted</font><font color="#007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//List out the top 10 and call routine to print a block of colour<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">for (</font><font color="#0000BB">$i </font><font color="#007700">= </font><font color="#0000BB">1</font><font color="#007700">; </font><font color="#0000BB">$i </font><font color="#007700">&lt; </font><font color="#0000BB">11</font><font color="#007700">; </font><font color="#0000BB">$i</font><font color="#007700">++) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//echo "&lt;BR&gt;".$sorted[0][$i].",".$sorted[1][$i].",".$sorted[2][$i].",".$sorted[3][$i];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">"&lt;IMG SRC=\"block.php?red="</font><font color="#007700">.</font><font color="#0000BB">$sorted</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">].</font><font color="#DD0000">"&amp;grn="</font><font color="#007700">.</font><font color="#0000BB">$sorted</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">].</font><font color="#DD0000">"&amp;blu="</font><font color="#007700">.</font><font color="#0000BB">$sorted</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">].</font><font color="#DD0000">"\" BORDER=0 ALT=\"\"&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function </font><font color="#0000BB">thumbs</font><font color="#007700">(</font><font color="#0000BB">$srcurl</font><font color="#007700">,</font><font color="#0000BB">$tarurl</font><font color="#007700">,</font><font color="#0000BB">$posx</font><font color="#007700">,</font><font color="#0000BB">$posy</font><font color="#007700">,</font><font color="#0000BB">$regnum</font><font color="#007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Draw thumbnail of sample region for source and target<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">"&lt;P&gt;Region $regnum has been analysed.&lt;BR&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"&lt;IMG SRC=\"rgthumb.php?srcimg=$srcurl&amp;posx=$posx&amp;posy=$posy\" BORDER=0 ALT=\"\"&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"&amp;nbsp;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"&lt;IMG SRC=\"rgthumb.php?srcimg=$tarurl&amp;posx=$posx&amp;posy=$posy\" BORDER=0 ALT=\"\"&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"&lt;BR&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function </font><font color="#0000BB">comp</font><font color="#007700">(</font><font color="#0000BB">$sregion</font><font color="#007700">,</font><font color="#0000BB">$tregion</font><font color="#007700">,</font><font color="#0000BB">$var</font><font color="#007700">,</font><font color="#0000BB">$rvar</font><font color="#007700">,</font><font color="#0000BB">$prev</font><font color="#007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$count </font><font color="#007700">= </font><font color="#0000BB">0</font><font color="#007700">;&nbsp;&nbsp;</font><font color="#FF8000">//Set counter to zero<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if (</font><font color="#0000BB">$prev </font><font color="#007700">== </font><font color="#DD0000">'y'</font><font color="#007700">) {<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (</font><font color="#0000BB">$i </font><font color="#007700">= </font><font color="#0000BB">1</font><font color="#007700">; </font><font color="#0000BB">$i </font><font color="#007700">&lt; </font><font color="#0000BB">11</font><font color="#007700">; </font><font color="#0000BB">$i</font><font color="#007700">++) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((</font><font color="#0000BB">$sregion</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &lt; </font><font color="#0000BB">$tregion</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] + </font><font color="#0000BB">$var</font><font color="#007700">) &amp;&amp; (</font><font color="#0000BB">$sregion</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &gt; </font><font color="#0000BB">$tregion</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] - </font><font color="#0000BB">$var</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((</font><font color="#0000BB">$sregion</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &lt; </font><font color="#0000BB">$tregion</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] + </font><font color="#0000BB">$var</font><font color="#007700">) &amp;&amp; (</font><font color="#0000BB">$sregion</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &gt; </font><font color="#0000BB">$tregion</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] - </font><font color="#0000BB">$var</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((</font><font color="#0000BB">$sregion</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &lt; </font><font color="#0000BB">$tregion</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] + </font><font color="#0000BB">$var</font><font color="#007700">) &amp;&amp; (</font><font color="#0000BB">$sregion</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &gt; </font><font color="#0000BB">$tregion</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] - </font><font color="#0000BB">$var</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$count</font><font color="#007700">++;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (</font><font color="#0000BB">$i </font><font color="#007700">= </font><font color="#0000BB">1</font><font color="#007700">; </font><font color="#0000BB">$i </font><font color="#007700">&lt; </font><font color="#0000BB">11</font><font color="#007700">; </font><font color="#0000BB">$i</font><font color="#007700">++) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$found </font><font color="#007700">= </font><font color="#0000BB">false</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (</font><font color="#0000BB">$j </font><font color="#007700">= </font><font color="#0000BB">1</font><font color="#007700">; (</font><font color="#0000BB">$j </font><font color="#007700">&lt; </font><font color="#0000BB">11</font><font color="#007700">) &amp;&amp; (</font><font color="#0000BB">$found </font><font color="#007700">== </font><font color="#0000BB">false</font><font color="#007700">); </font><font color="#0000BB">$j</font><font color="#007700">++) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((</font><font color="#0000BB">$sregion</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &lt; </font><font color="#0000BB">$tregion</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$j</font><font color="#007700">] + </font><font color="#0000BB">$var</font><font color="#007700">) &amp;&amp; (</font><font color="#0000BB">$sregion</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &gt; </font><font color="#0000BB">$tregion</font><font color="#007700">[</font><font color="#0000BB">0</font><font color="#007700">][</font><font color="#0000BB">$j</font><font color="#007700">] - </font><font color="#0000BB">$var</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((</font><font color="#0000BB">$sregion</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &lt; </font><font color="#0000BB">$tregion</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$j</font><font color="#007700">] + </font><font color="#0000BB">$var</font><font color="#007700">) &amp;&amp; (</font><font color="#0000BB">$sregion</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &gt; </font><font color="#0000BB">$tregion</font><font color="#007700">[</font><font color="#0000BB">1</font><font color="#007700">][</font><font color="#0000BB">$j</font><font color="#007700">] - </font><font color="#0000BB">$var</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((</font><font color="#0000BB">$sregion</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &lt; </font><font color="#0000BB">$tregion</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][</font><font color="#0000BB">$j</font><font color="#007700">] + </font><font color="#0000BB">$var</font><font color="#007700">) &amp;&amp; (</font><font color="#0000BB">$sregion</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][</font><font color="#0000BB">$i</font><font color="#007700">] &gt; </font><font color="#0000BB">$tregion</font><font color="#007700">[</font><font color="#0000BB">2</font><font color="#007700">][</font><font color="#0000BB">$j</font><font color="#007700">] - </font><font color="#0000BB">$var</font><font color="#007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$count</font><font color="#007700">++;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$found </font><font color="#007700">= </font><font color="#0000BB">true</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If (</font><font color="#0000BB">$count </font><font color="#007700">&gt;= </font><font color="#0000BB">$rvar</font><font color="#007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"&lt;BR&gt;&lt;B&gt;Regions MATCH! $count colours are the same.&lt;/B&gt;"</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">"&lt;BR&gt;No match. $count colours are the same."</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /></font><font color="#0000BB">?&gt;<br /></font><br />&lt;/BODY&gt;<br />&lt;/HTML&gt;</font>
</code>

<P>I know there's some repetition in the mainline code but I was trying to avoid passing too many vars when I called a function and keep it
easier to read.</P>
<P>Well that's pretty much this part finished off. In Part 3 I will bolt on a web spider so we can go crawling for images to 
compare and look at some attempts to 
improve the accuracy and speed. Hopefully I will also try a variation on this colour matching technique to overcome the problem 
if one of the images has been colour filtered.</P>

<P><A HREF="finn_cbir_1.htm">Back to PART 1</A>

<P><CENTER>PART3 Coming Soon!</CENTER>
<CENTER><P>* ~* ~**</P></CENTER>
<br><br>
(c) Finn61,  2006 &nbsp;&nbsp;



</font><br><center>
<hr width="66%">
<a target=_top href=
"basic.htm"><img src="images/basipet.jpg"
     alt="Petit image" align="bottom" width="118" height="68"
     border="0" vspace="0" hspace="0"></a><br>
<br></font> 
<table>
<tr>
<td width="300" height="2" bgcolor="#993300"></td></tr></table>
(c) III Millennium: <font color=
"blue">[</font><a target=_top href=
"info.htm">fravia+</a><font color=
"blue">]</font>, all rights reserved, reversed, reviled and revealed</font></center></div>
</body>
</html>
</BODY>
</HTML>